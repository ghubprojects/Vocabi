@page "/vocabularies/pending"
@rendermode InteractiveServer
@using Vocabi.Web.Common.Enums
@using Vocabi.Web.ViewModels.Vocabularies.Pending
@using Vocabi.Shared.Utils
@inherits BasePage

<PageTitle>Vocabulary Pending List</PageTitle>

<FluentStack Orientation="Orientation.Vertical">
    <FluentStack HorizontalAlignment="HorizontalAlignment.SpaceBetween" VerticalAlignment="VerticalAlignment.Center">
        <FluentStack VerticalAlignment="VerticalAlignment.Center">
            <FluentLabel Typo="Typography.H4">
                Vocabulary Pending List
            </FluentLabel>
        </FluentStack>
        <FluentStack VerticalAlignment="VerticalAlignment.Center" Width="auto">
            <FluentButton Appearance="Appearance.Accent"
                          IconStart="@(new Icons.Regular.Size16.Add())"
                          OnClick="Navigation.GoToVocabularyPendingCreate">
                Create
            </FluentButton>
        </FluentStack>
    </FluentStack>

    <FluentStack HorizontalAlignment="HorizontalAlignment.SpaceBetween" VerticalAlignment="VerticalAlignment.Center">
        <FluentSearch @bind-Value="searchWord"
                      @bind-Value:after="RefreshDataAsync"
                      Immediate="true"
                      ImmediateDelay="500"
                      Placeholder="Search for word"
                      Style="flex:1;" />
        <FluentStack Width="auto">
            <FluentButton Title="Delete selected"
                          OnClick="()=>{}"
                          Disabled="@(isDeletingMultiple || !isAnyItemSelected)"
                          Loading="isDeletingMultiple"
                          BackgroundColor="var(--error)"
                          Color="var(--neutral-fill-rest)">
                <FluentIcon Value="@(new Icons.Regular.Size16.Delete())" Color="@Color.Fill" Slot="start" />
                @(isDeletingMultiple ? "Deleting..." : $"Delete{(selectedItems.Count() > 0 ? $" ({selectedItems.Count()})" : "")}")
            </FluentButton>
            <FluentButton Title="Export selected to Anki"
                          OnClick="HandleExportMultipleAsync"
                          Loading="isExportingMultiple"
                          Disabled="@(isExportingMultiple || !isAnyItemSelected)"
                          BackgroundColor="#16a34a"
                          Color="var(--neutral-fill-rest)">
                <FluentIcon Value="@(new Icons.Regular.Size16.ArrowExport())" Color="@Color.Fill" Slot="start" />
                @(isExportingMultiple ? "Exporting..." : $"Export{(selectedItems.Count() > 0 ? $" ({selectedItems.Count()})" : "")}")
            </FluentButton>
        </FluentStack>
    </FluentStack>

    <FluentStack Orientation="Orientation.Vertical" Style="padding-top:10px">
        <FluentDataGrid @ref="dataGrid"
                        Pagination="pagination"
                        TGridItem="PendingVocabularyListItemViewModel"
                        Items="@dataGridItems"
                        RefreshItems="RefreshItemsAsync"
                        Loading="isRefreshingData"
                        GenerateHeader="GenerateHeaderOption.Sticky"
                        DisplayMode="DataGridDisplayMode.Table"
                        OnRowDoubleClick="HandleDoubleClickRow"
                        AutoFit="true"
                        ShowHover="true"
                        Style="width:100%;">
            <ChildContent>
                <SelectColumn TGridItem="PendingVocabularyListItemViewModel"
                              SelectMode="DataGridSelectMode.Multiple"
                              SelectFromEntireRow="false"
                              @bind-SelectedItems="selectedItems" />
                <PropertyColumn Property="@(c => c.Word)" />
                <PropertyColumn Property="@(c => c.PartOfSpeech)" Title="Part of speech" />
                <PropertyColumn Property="@(c => c.Pronunciation)" />
                <PropertyColumn Property="@(c => c.Cloze)" />
                <PropertyColumn Property="@(c => c.Meaning)" />
                <TemplateColumn Title="Actions" Align="@Align.Center">
                    <FluentButton Title="View"
                                  OnClick="() => Navigation.GoToVocabularyPendingDetail(context.Id)"
                                  IconEnd="@(new Icons.Regular.Size20.Eye())" />
                    <FluentButton Title="Edit"
                                  OnClick="() => Navigation.GoToVocabularyPendingEdit(context.Id)">
                        <FluentIcon Value="@(new Icons.Regular.Size16.Edit())" Color="Color.Warning" />
                    </FluentButton>
                    <FluentButton Title="Delete"
                                  OnClick="() => OpenDeleteDialogAsync(context)">
                        <FluentIcon Value="@(new Icons.Regular.Size16.Delete())" Color="Color.Error" />
                    </FluentButton>
                    <FluentButton Title="Export"
                                  OnClick="() => HandleExportAsync(context.Id)"
                                  Loading="IsLoading(context.Id, RowAction.Export)"
                                  Disabled="IsLoading(context.Id, RowAction.Export) || (isExportingMultiple && selectedItems.Contains(context))">
                        <FluentIcon Value="@(new Icons.Regular.Size16.ArrowExport())"
                                    Color="Color.Custom"
                                    CustomColor="#16a34a" />
                    </FluentButton>
                </TemplateColumn>
            </ChildContent>
            <EmptyContent>
                <FluentStack Orientation="Orientation.Horizontal"
                             HorizontalAlignment="HorizontalAlignment.Center"
                             VerticalAlignment="VerticalAlignment.Center"
                             HorizontalGap="10">
                    <FluentIcon Value="@(new Icons.Filled.Size24.Crown())" Color="@Color.Accent" />
                    <div>Nothing to see here. Carry on!</div>
                </FluentStack>
            </EmptyContent>
        </FluentDataGrid>
        <FluentPaginator State="pagination" Style="width:100%;margin-top:0" />
    </FluentStack>
</FluentStack>